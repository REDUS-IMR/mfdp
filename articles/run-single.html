<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run MFDP with a Single Input File • mfdp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Run MFDP with a Single Input File">
<meta property="og:description" content="mfdp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mfdp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/run-classic.html">Run MFDP with the Classic Input Data</a>
    </li>
    <li>
      <a href="../articles/run-single.html">Run MFDP with a Single Input File</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="run-single_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="run-single_files/kePrint-0.0.1/kePrint.js"></script><link href="run-single_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Run MFDP with a Single Input File</h1>
            
      
      
      <div class="hidden name"><code>run-single.Rmd</code></div>

    </div>

    
    
<p>In addition to the classic Lowestoft’s MFDP input data, R MFDP also supports running forecast using a single file for its input data. This new method simplify the run for the users as they can have a quick overview of the data quickly.</p>
<p>Please note you will need to provide a control file if you want to use a single input data file.</p>
<p>The <code>mfdp</code> package provides two samples of the single input files: <a href="https://github.com/REDUS-IMR/mfdp/tree/main/inst/sample">here</a>. In the same directory you can also find a sample of the control file.</p>
<div id="tldr" class="section level2">
<h2 class="hasAnchor">
<a href="#tldr" class="anchor"></a>TLDR</h2>
<p>For the impatient, here is how to quickly run a forecast using the provided sample files:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load library</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mfdp</span><span class="op">)</span>

<span class="co"># Get input data path</span>
<span class="va">input_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"sample"</span>, <span class="st">"nea-had-2020.input.csv"</span>, package <span class="op">=</span> <span class="st">"mfdp"</span><span class="op">)</span>
<span class="co"># Get param data path</span>
<span class="va">config_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"sample"</span>, <span class="st">"nea-had-2020.params.txt"</span>, package <span class="op">=</span> <span class="st">"mfdp"</span><span class="op">)</span>

<span class="co"># Reading a single file input must be done in two steps</span>
<span class="co">## Parse the input as FLStock object</span>
<span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_mfdp_input_table.html">read_mfdp_input_table</a></span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span>
<span class="co">## Run the forecast</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mfdp.html">mfdp</a></span><span class="op">(</span><span class="va">input</span>, configs <span class="op">=</span> <span class="va">config_file</span>, run_name <span class="op">=</span> <span class="st">"test"</span>, out_dir <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></code></pre></div>
<p>For the more detailed descriptions, please continue below.</p>
</div>
<div id="input-data-file-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#input-data-file-structure" class="anchor"></a>Input data file structure</h2>
<p>The structure of the input data file is identical to the Lowestoft’s MFDP <code>.prd</code> file output. Here is an example of the data:</p>
<p><strong>nea-had-2020.input.csv</strong></p>
<pre><code>"MFDP version 1a"
"Run: Manage2020"
"Time and date: 15:02 27.04.2020"
"Fbar age range: 4-7"
""
""
2020
"Age","N","M","Mat","PF","PM","SWt","Sel","CWt"
3,497416,.402,.027839644,0,0,.276890309,.037,.716
4,531880,.269,.084263959,0,0,.518907563,.154,.95
5,171000,.238,.230460922,0,0,.859979101,.324,1.224
6,60331,.273,.526207605,0,0,1.35966736,.504,1.604
7,29429,.2,.779874214,0,0,1.854188211,.524,1.895
8,10839,.2,.884133612,0,0,2.16838843,.584,2.077
9,9746,.2,.963917526,0,0,2.784901758,.584,2.38
10,3557,.2,.976530612,0,0,3.015625,.584,2.626
11,4436,.2,1,0,0,3.542497377,.584,2.79
12,1896,.2,1,0,0,3.361,.584,3.045
13,4665,.2,1,0,0,3.628,.584,3.329
""
2021
"Age","N","M","Mat","PF","PM","SWt","Sel","CWt"
3,293623,.402,.029,0,0,.269,.037,.708
4,".",.269,.083,0,0,.515,.154,.946
5,".",.238,.215,0,0,.823,.324,1.192
6,".",.273,.457,0,0,1.214,.504,1.471
7,".",.2,.756,0,0,1.774,.524,1.846
8,".",.2,.904,0,0,2.285,.584,2.128
9,".",.2,.948,0,0,2.585,.584,2.311
10,".",.2,.985,0,0,3.222,.584,2.627
11,".",.2,1,0,0,3.416,.584,2.806
12,".",.2,1,0,0,3.726,.584,2.993
13,".",.2,1,0,0,3.677,.584,3.417
""
2022
"Age","N","M","Mat","PF","PM","SWt","Sel","CWt"
3,38636,.402,.029,0,0,.303,.037,.744
4,".",.269,.086,0,0,.526,.154,.957
5,".",.238,.21,0,0,.812,.324,1.182
6,".",.273,.436,0,0,1.168,.504,1.43
7,".",.2,.693,0,0,1.589,.524,1.736
8,".",.2,.888,0,0,2.191,.584,2.087
9,".",.2,.959,0,0,2.718,.584,2.358
10,".",.2,.976,0,0,3.001,.584,2.573
11,".",.2,1,0,0,3.624,.584,2.807
12,".",.2,1,0,0,3.596,.584,3.004
13,".",.2,1,0,0,4.029,.584,3.376
""

"Input units are thousands and kg - output in tonnes"</code></pre>
</div>
<div id="control-file-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#control-file-structure" class="anchor"></a>Control file structure</h2>
<p>The control file must be a text file. Here is a sample of the configuration file:</p>
<p><strong>nea-had-2020.params.txt</strong></p>
<pre><code>* example param file for NEA Haddock 2020
Ftarget 0.35 * target F in HCR
Fpa 0.47 * Fpa
Flim 0.77 * Flim
Fagerange 4 7 * age range for reference F (if not given anywhere else)
Bpa 80000 * trigger point in HCR
3yearrule no * use 3-rule in calculating TAC, yes/no
TACpreviousyear 215000 * TAC in intermediate year, used in connection with calculating TAC in first year
maxchangeup 25 * max annual increase in TAC (%)
maxchangedown 25 * max annual decrease of TAC (%)</code></pre>
<blockquote>
<p>NOTE: The keywords are <strong>case sensitive</strong> and all the values are <strong>mandatory</strong>.</p>
</blockquote>
</div>
<div id="running-the-forecast" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-forecast" class="anchor"></a>Running the forecast</h2>
<p>Running the forecast using the single input is a two-steps procedure:</p>
<div id="loading-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#loading-the-data" class="anchor"></a>Loading the data</h3>
<p>The first step is we load the data into an <code>FLStock</code> class object:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the mfdp library</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mfdp</span><span class="op">)</span>

<span class="co"># Load the input data</span>
<span class="va">input_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"sample"</span>, <span class="st">"nea-had-2020.input.csv"</span>, package <span class="op">=</span> <span class="st">"mfdp"</span><span class="op">)</span>
<span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_mfdp_input_table.html">read_mfdp_input_table</a></span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLStock"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Name:  </span>
<span class="co">#&gt; Description:  </span>
<span class="co">#&gt; Quant: age </span>
<span class="co">#&gt; Dims:  age   year    unit    season  area    iter</span>
<span class="co">#&gt;  11  3   1   1   1   1   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Range:  min  max pgroup  minyear maxyear minfbar maxfbar </span>
<span class="co">#&gt;  3   13  13  2020    2022    4   7   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; catch         : [ 1 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; catch.n       : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; catch.wt      : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; discards      : [ 1 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; discards.n    : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; discards.wt   : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; landings      : [ 1 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; landings.n    : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; landings.wt   : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; stock         : [ 1 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; stock.n       : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; stock.wt      : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; m             : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; mat           : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; harvest       : [ 11 3 1 1 1 1 ], units =  f </span>
<span class="co">#&gt; harvest.spwn  : [ 11 3 1 1 1 1 ], units =  NA </span>
<span class="co">#&gt; m.spwn        : [ 11 3 1 1 1 1 ], units =  NA</span></code></pre></div>
<p>You might want to examine the input data to make sure everyting are properly loaded:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the FLCore library</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://flr-project.org/FLCore">FLCore</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: lattice</span>
<span class="co">#&gt; Loading required package: iterators</span>
<span class="co">#&gt; FLCore (Version 2.6.16.9004, packaged: 2021-09-29 09:21:02 UTC)</span>

<span class="co"># Do checks</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="http://flr-project.org/FLCore/reference/accessors.html">catch.n</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     year</span>
<span class="co">#&gt; age  2020 2021 2022</span>
<span class="co">#&gt;   3  NA   NA   NA  </span>
<span class="co">#&gt;   4  NA   NA   NA  </span>
<span class="co">#&gt;   5  NA   NA   NA  </span>
<span class="co">#&gt;   6  NA   NA   NA  </span>
<span class="co">#&gt;   7  NA   NA   NA  </span>
<span class="co">#&gt;   8  NA   NA   NA  </span>
<span class="co">#&gt;   9  NA   NA   NA  </span>
<span class="co">#&gt;   10 NA   NA   NA  </span>
<span class="co">#&gt;   11 NA   NA   NA  </span>
<span class="co">#&gt;   12 NA   NA   NA  </span>
<span class="co">#&gt;   13 NA   NA   NA  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="http://flr-project.org/FLCore/reference/accessors.html">catch.wt</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     year</span>
<span class="co">#&gt; age  2020  2021  2022 </span>
<span class="co">#&gt;   3  0.716 0.708 0.744</span>
<span class="co">#&gt;   4  0.950 0.946 0.957</span>
<span class="co">#&gt;   5  1.224 1.192 1.182</span>
<span class="co">#&gt;   6  1.604 1.471 1.430</span>
<span class="co">#&gt;   7  1.895 1.846 1.736</span>
<span class="co">#&gt;   8  2.077 2.128 2.087</span>
<span class="co">#&gt;   9  2.380 2.311 2.358</span>
<span class="co">#&gt;   10 2.626 2.627 2.573</span>
<span class="co">#&gt;   11 2.790 2.806 2.807</span>
<span class="co">#&gt;   12 3.045 2.993 3.004</span>
<span class="co">#&gt;   13 3.329 3.417 3.376</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="http://flr-project.org/FLCore/reference/accessors.html">stock.n</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     year</span>
<span class="co">#&gt; age  2020   2021   2022  </span>
<span class="co">#&gt;   3  497416 293623  38636</span>
<span class="co">#&gt;   4  531880     NA     NA</span>
<span class="co">#&gt;   5  171000     NA     NA</span>
<span class="co">#&gt;   6   60331     NA     NA</span>
<span class="co">#&gt;   7   29429     NA     NA</span>
<span class="co">#&gt;   8   10839     NA     NA</span>
<span class="co">#&gt;   9    9746     NA     NA</span>
<span class="co">#&gt;   10   3557     NA     NA</span>
<span class="co">#&gt;   11   4436     NA     NA</span>
<span class="co">#&gt;   12   1896     NA     NA</span>
<span class="co">#&gt;   13   4665     NA     NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="http://flr-project.org/FLCore/reference/accessors.html">stock.wt</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     year</span>
<span class="co">#&gt; age  2020    2021    2022   </span>
<span class="co">#&gt;   3  0.27689 0.26900 0.30300</span>
<span class="co">#&gt;   4  0.51891 0.51500 0.52600</span>
<span class="co">#&gt;   5  0.85998 0.82300 0.81200</span>
<span class="co">#&gt;   6  1.35967 1.21400 1.16800</span>
<span class="co">#&gt;   7  1.85419 1.77400 1.58900</span>
<span class="co">#&gt;   8  2.16839 2.28500 2.19100</span>
<span class="co">#&gt;   9  2.78490 2.58500 2.71800</span>
<span class="co">#&gt;   10 3.01562 3.22200 3.00100</span>
<span class="co">#&gt;   11 3.54250 3.41600 3.62400</span>
<span class="co">#&gt;   12 3.36100 3.72600 3.59600</span>
<span class="co">#&gt;   13 3.62800 3.67700 4.02900</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="http://flr-project.org/FLCore/reference/ssb.html">ssb</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      year</span>
<span class="co">#&gt; age   2020      2021      2022     </span>
<span class="co">#&gt;   all 243130.52   2290.55    339.49</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">fbar</span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      year</span>
<span class="co">#&gt; age   2020   2021   2022  </span>
<span class="co">#&gt;   all 0.3765 0.3765 0.3765</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  f</span>

<span class="co"># and so on...</span></code></pre></div>
</div>
<div id="run-forecast-using-the-control-file" class="section level3">
<h3 class="hasAnchor">
<a href="#run-forecast-using-the-control-file" class="anchor"></a>Run forecast using the control file</h3>
<p>Now that you are confident that the data is properly loaded, we can continue to run the forecast:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the config file path</span>
<span class="va">config_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"sample"</span>, <span class="st">"nea-had-2020.params.txt"</span>,
                  package <span class="op">=</span> <span class="st">"mfdp"</span><span class="op">)</span>

<span class="co"># Do forecast</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mfdp.html">mfdp</a></span><span class="op">(</span><span class="va">input</span>, configs <span class="op">=</span> <span class="va">config_file</span>, run_name <span class="op">=</span> <span class="st">"test"</span>, out_dir <span class="op">=</span> <span class="st">"out-single"</span><span class="op">)</span>
<span class="co">#&gt; Warning in is.na(raw$stk): is.na() applied to non-(list or vector) of type 'S4'</span>
<span class="co">#&gt; Saving 7.29 x 4.51 in image</span>
<span class="co">#&gt; Saving 7.29 x 4.51 in image</span>
<span class="co">#&gt; Saving 7.29 x 4.51 in image</span>
<span class="co">#&gt; Saving 7.29 x 4.51 in image</span>
<span class="co">#&gt; Saving 7.29 x 4.51 in image</span>
<span class="co">#&gt; Saving 7.29 x 4.51 in image</span>
<span class="co">#&gt; Saving 7.29 x 4.51 in image</span>
<span class="co">#&gt; Saving 7.29 x 4.51 in image</span>
<span class="co">#&gt; Saving 7.29 x 4.51 in image</span>
<span class="co">#&gt; Saving 7.29 x 4.51 in image</span></code></pre></div>
</div>
</div>
<div id="output-files" class="section level2">
<h2 class="hasAnchor">
<a href="#output-files" class="anchor"></a>Output Files</h2>
<p>Running the <code>mfdp</code> function above will instruct MFDP to run the forecast and write output files into <code>./out</code> directory. We can check the output files:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"out-classic"</span><span class="op">)</span>
<span class="co">#&gt; [1] "test_prm_plot.pdf" "test_prs_plot.pdf" "test-prm.pdf"     </span>
<span class="co">#&gt; [4] "test-prs.pdf"      "test.xlsx"</span></code></pre></div>
<blockquote>
<p>NOTE: Since we use a control file that contains <strong>Fpa</strong>, <strong>Flim</strong>, etc. we are presented with several output files from different F used in the forecast. Note also the summary file that collated the results summary from the runs.</p>
</blockquote>
</div>
<div id="results" class="section level2">
<h2 class="hasAnchor">
<a href="#results" class="anchor"></a>Results</h2>
<p>After successfully running a forecast, MFDP returns several output objects in a single list.</p>
<p>The first level will have the sub-list of <strong>prm</strong> for the <strong>Management Options Table</strong> and <strong>prs</strong> for the <strong>Single Option Prediction</strong> results and<br>
a <strong>summary table</strong>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="http://flr-project.org/FLCore/reference/names.html">names</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "prm"     "prs"     "summary"</span></code></pre></div>
<p>Let’s see the summary from the different F basis:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span>,
            bootstrap_options <span class="op">=</span> <span class="st">"striped"</span>, latex_options <span class="op">=</span> <span class="st">"striped"</span><span class="op">)</span></code></pre></div>
<table class="table table table-striped">
<thead><tr>
<th style="text-align:left;">
Basis
</th>
<th style="text-align:right;">
Total catch (2021)
</th>
<th style="text-align:right;">
F ages 4-7 (2021)
</th>
<th style="text-align:right;">
SSB (2022)
</th>
<th style="text-align:right;">
% SSB change
</th>
<th style="text-align:right;">
% TAC change
</th>
<th style="text-align:right;">
% Advice change
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
fmgmt
</td>
<td style="text-align:right;">
232542.8
</td>
<td style="text-align:right;">
0.3499983
</td>
<td style="text-align:right;">
272206.9
</td>
<td style="text-align:right;">
9.070391
</td>
<td style="text-align:right;">
8.159432
</td>
<td style="text-align:right;">
8.159432
</td>
</tr>
<tr>
<td style="text-align:left;">
f0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
394626.3
</td>
<td style="text-align:right;">
58.122544
</td>
<td style="text-align:right;">
-100.000000
</td>
<td style="text-align:right;">
-100.000000
</td>
</tr>
<tr>
<td style="text-align:left;">
fsq
</td>
<td style="text-align:right;">
245405.4
</td>
<td style="text-align:right;">
0.3731790
</td>
<td style="text-align:right;">
265781.1
</td>
<td style="text-align:right;">
6.495637
</td>
<td style="text-align:right;">
14.142057
</td>
<td style="text-align:right;">
14.142057
</td>
</tr>
<tr>
<td style="text-align:left;">
fpa
</td>
<td style="text-align:right;">
296276.8
</td>
<td style="text-align:right;">
0.4700000
</td>
<td style="text-align:right;">
240776.3
</td>
<td style="text-align:right;">
-3.523517
</td>
<td style="text-align:right;">
37.803148
</td>
<td style="text-align:right;">
37.803148
</td>
</tr>
<tr>
<td style="text-align:left;">
flim
</td>
<td style="text-align:right;">
428699.2
</td>
<td style="text-align:right;">
0.7700000
</td>
<td style="text-align:right;">
179098.2
</td>
<td style="text-align:right;">
-28.237287
</td>
<td style="text-align:right;">
99.394955
</td>
<td style="text-align:right;">
99.394955
</td>
</tr>
</tbody>
</table>
<p>Each <strong>prm</strong> and <strong>prs</strong> sub-lists contains the different basis of F used in the forecast.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use the F management</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="http://flr-project.org/FLCore/reference/names.html">names</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="st">"prm"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "fmgmt" "f0"    "fsq"   "fpa"   "flim"</span>

<span class="co"># Let's see the Management Options Table for Fmgmt</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="st">"prm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"fmgmt"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; $stk</span>
<span class="co">#&gt; An object of class "FLStock"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Name:  </span>
<span class="co">#&gt; Description:  </span>
<span class="co">#&gt; Quant: age </span>
<span class="co">#&gt; Dims:  age   year    unit    season  area    iter</span>
<span class="co">#&gt;  11  3   1   1   1   21  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Range:  min  max pgroup  minyear maxyear minfbar maxfbar </span>
<span class="co">#&gt;  3   13  13  2020    2022    4   7   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; catch         : [ 1 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; catch.n       : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; catch.wt      : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; discards      : [ 1 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; discards.n    : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; discards.wt   : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; landings      : [ 1 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; landings.n    : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; landings.wt   : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; stock         : [ 1 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; stock.n       : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; stock.wt      : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; m             : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; mat           : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; harvest       : [ 11 3 1 1 1 21 ], units =  f </span>
<span class="co">#&gt; harvest.spwn  : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; m.spwn        : [ 11 3 1 1 1 21 ], units =  NA </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $fmult</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; iters:  21 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      year</span>
<span class="co">#&gt; age   2020           2021           2022          </span>
<span class="co">#&gt;   all 0.99118(0.000) 1.00000(0.741) 1.00000(0.741)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ftgt</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; iters:  21 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      year</span>
<span class="co">#&gt; age   2020       2021       2022      </span>
<span class="co">#&gt;   all 0.37318(0) 0.00000(0) 0.00000(0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters</span>
<span class="co">#&gt; $parameters$flag</span>
<span class="co">#&gt; [1] 1 1 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$target</span>
<span class="co">#&gt; [1] 215000.00 232543.00      0.35</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$hcrObj</span>
<span class="co">#&gt; $parameters$hcrObj$args</span>
<span class="co">#&gt; $parameters$hcrObj$args$tac</span>
<span class="co">#&gt; [1] 215000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$hcrObj$args$ftgt</span>
<span class="co">#&gt; [1] 0.35</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$hcrObj$args$fpa</span>
<span class="co">#&gt; [1] 0.47</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$hcrObj$args$flim</span>
<span class="co">#&gt; [1] 0.77</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$hcrObj$args$fbar</span>
<span class="co">#&gt; [1] 4 7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$hcrObj$args$bpa</span>
<span class="co">#&gt; [1] 80000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$hcrObj$args$threeYrRule</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$hcrObj$args$maxTACVar</span>
<span class="co">#&gt; [1] 0.25</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$hcrObj$args$minTACVar</span>
<span class="co">#&gt; [1] 0.25</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters$ssbunder</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; iters:  21 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      year</span>
<span class="co">#&gt; age   2020 2021 2022</span>
<span class="co">#&gt;   all 0(0) 0(0) 0(0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA</span></code></pre></div>
<p>The <strong>stk</strong> object is an <code>FLStock</code> class object <a href="https://flr-project.org/FLCore/reference/FLStock.html" class="uri">https://flr-project.org/FLCore/reference/FLStock.html</a> from the <code>FLR</code> suite <a href="https://flr-project.org/" class="uri">https://flr-project.org/</a>. The developers have provide a wealth of tutorial about the format here: <a href="https://flr-project.org/#tutorials" class="uri">https://flr-project.org/#tutorials</a>.</p>
<p>Next we have the <strong>fmult</strong> object, which holds the <em>F multiplier</em> values over the years in the <code>FLQuant</code> class, the <strong>ftgt</strong> object which is the <em>F target</em> over the years, and lastly <strong>parameters</strong> object, which is the control parameters/configuration for the forecast.</p>
<p>Some example of methods supported by FLStock:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://flr-project.org/FLCore">FLCore</a></span><span class="op">)</span>

<span class="co"># Get the SSB</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="http://flr-project.org/FLCore/reference/ssb.html">ssb</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="st">"prm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"fmgmt"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stk</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; iters:  21 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      year</span>
<span class="co">#&gt; age   2020          2021          2022         </span>
<span class="co">#&gt;   all 243131(    0) 249570(    0) 264875(80037)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA</span>

<span class="co"># Get the Catch total</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="http://flr-project.org/FLCore/reference/accessors.html">catch</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="st">"prm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"fmgmt"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stk</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; iters:  21 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      year</span>
<span class="co">#&gt; age   2020           2021           2022          </span>
<span class="co">#&gt;   all 215000(     0) 247226(165771) 240332( 79521)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA</span>

<span class="co"># Get the Catch number</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="http://flr-project.org/FLCore/reference/accessors.html">catch.n</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="st">"prm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"fmgmt"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stk</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; iters:  21 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     year</span>
<span class="co">#&gt; age  2020              2021              2022             </span>
<span class="co">#&gt;   3  14767.05(    0.0)  8793.18( 6462.2)  1157.04(  850.3)</span>
<span class="co">#&gt;   4  66243.10(    0.0) 40281.60(28765.0) 23770.33(16633.2)</span>
<span class="co">#&gt;   5  42064.91(    0.0) 86478.01(59145.6) 52084.48(26082.8)</span>
<span class="co">#&gt;   6  20994.82(    0.0) 34256.37(20699.3) 69694.91(17848.1)</span>
<span class="co">#&gt;   7  10898.65(    0.0) 10389.28( 6142.2) 16256.27( 1784.5)</span>
<span class="co">#&gt;   8   4358.64(    0.0)  5802.15( 3272.4)  5214.05(  554.3)</span>
<span class="co">#&gt;   9   3919.12(    0.0)  2013.61( 1135.7)  2459.93(  293.8)</span>
<span class="co">#&gt;   10  1430.36(    0.0)  1810.56( 1021.1)   853.71(  101.9)</span>
<span class="co">#&gt;   11  1783.83(    0.0)   660.80(  372.7)   767.62(   91.7)</span>
<span class="co">#&gt;   12   762.43(    0.0)   824.10(  464.8)   280.16(   33.5)</span>
<span class="co">#&gt;   13  1875.92(    0.0)  1218.87(  687.4)   866.15(  103.4)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  NA</span>

<span class="co"># Get the Fbar</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">fbar</span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="st">"prm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"fmgmt"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stk</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; An object of class "FLQuant"</span>
<span class="co">#&gt; iters:  21 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , unit = unique, season = all, area = unique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      year</span>
<span class="co">#&gt; age   2020           2021           2022          </span>
<span class="co">#&gt;   all 0.37318(0.000) 0.37650(0.279) 0.37650(0.279)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; units:  f</span></code></pre></div>
<p>Let’s plot the forecast results:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot the Management Options Table</span>
<span class="fu"><a href="http://flr-project.org/FLCore/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="st">"prm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"fmgmt"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stk</span><span class="op">)</span></code></pre></div>
<p><img src="run-single_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Single Option Prediction</span>
<span class="fu"><a href="http://flr-project.org/FLCore/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="st">"prs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"fmgmt"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stk</span><span class="op">)</span></code></pre></div>
<p><img src="run-single_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ibrahim Umar, Norwegian Institute of Marine Research.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
